{"version":3,"file":"cameraclick.js","sources":["cameraclick.js"],"sourcesContent":["export default function CameraClick (element, camOptions) {\n  let isPlaying = false\n\n  const options = {\n    width: 320,\n    height: 480,\n    screenshotCaption: 'Screenshot',\n    resolution: 'auto',\n    captureCaption: { start: 'Start', stop: 'Stop' },\n    ...camOptions\n  }\n\n  let mediaTracks = {}\n  const videoElement = element\n\n  const captureBtn = document.createElement('button')\n  const videoCanvas = document.createElement('video')\n  const videoWrapper = document.createElement('div')\n  const wrapper = document.createElement('div')\n\n  const open = async (onOpen, onError) => {\n    if (typeof onOpen === 'function') {\n      onOpen((await checkPermissions()) === 'granted')\n    }\n\n    isPlaying = true\n    captureBtn.disabled = false\n\n    navigator.getUserMedia(\n      { video: true },\n      function (localMediaStream) {\n        videoWrapper.innerHTML = ''\n        videoWrapper.appendChild(videoCanvas)\n        videoCanvas.srcObject = localMediaStream\n        mediaTracks = localMediaStream\n        window.mediaTracks = mediaTracks\n      },\n      function (error) {\n        if (typeof onError === 'function') onError(error)\n      }\n    )\n  }\n\n  const capture = (captureArguments = {}) => {\n    const captureOptions = {\n      type: 'image/jpeg',\n      quality: 0.85,\n      stopStreamAfterCapture: true,\n      ...captureArguments\n    }\n    const canvas = document.createElement('canvas')\n    const { width, height } = [...mediaTracks.getVideoTracks()]\n      .filter(video => video.enabled)[0]\n      .getSettings()\n    canvas.width = width\n    canvas.height = height\n    canvas.getContext('2d').drawImage(videoCanvas, 0, 0)\n\n    if (typeof camOptions.onCapture === 'function') {\n      const { type, quality } = captureOptions\n      camOptions.onCapture({\n        image: canvas.toDataURL(type, quality),\n        cropInfo: {}\n      })\n    }\n  }\n\n  const close = activateCallback => {\n    captureBtn.disabled = true\n    isPlaying = false\n    videoCanvas.srcObject = null;\n\n    [...mediaTracks.getTracks()].map(track => track.stop())\n\n    if (typeof camOptions.onClose === 'function' && activateCallback) {\n      camOptions.onClose()\n    }\n  }\n\n  const checkPermissions = async function () {\n    const permissions = await navigator.permissions.query({ name: 'camera' })\n    const result = await permissions\n\n    return result.state\n  }\n\n  const isOpen = () => isPlaying\n\n  videoElement.className = 'cameraclick'\n  wrapper.className = `${element.className || 'element'}__wrapper`\n  videoWrapper.className = `${element.className || 'element'}__video-wrapper`\n  captureBtn.className = `${element.className || 'element'}__capture`\n  captureBtn.innerHTML = options.screenshotCaption\n  captureBtn.disabled = true\n  captureBtn.onclick = capture\n  videoCanvas.autoplay = true\n  videoCanvas.width = options.width\n  videoCanvas.height = options.height\n  videoCanvas.style.objectFit = 'cover'\n\n  wrapper.appendChild(videoWrapper)\n  wrapper.appendChild(captureBtn)\n  videoElement.appendChild(wrapper)\n\n  return {\n    isOpen,\n    capture,\n    open,\n    close\n  }\n}\n"],"names":["CameraClick","element","camOptions","isPlaying","options","width","height","screenshotCaption","resolution","captureCaption","start","stop","mediaTracks","videoElement","captureBtn","document","createElement","videoCanvas","videoWrapper","wrapper","capture","captureArguments","captureOptions","type","quality","stopStreamAfterCapture","canvas","getVideoTracks","filter","video","enabled","getSettings","getContext","drawImage","onCapture","image","toDataURL","cropInfo","checkPermissions","async","permissions","navigator","query","name","state","className","innerHTML","disabled","onclick","autoplay","style","objectFit","appendChild","isOpen","open","onOpen","onError","getUserMedia","localMediaStream","srcObject","window","error","close","activateCallback","getTracks","map","track","onClose"],"mappings":"aAAe,SAASA,YAAaC,EAASC,OACxCC,GAAY,QAEVC,EAAU,CACdC,MAAO,IACPC,OAAQ,IACRC,kBAAmB,aACnBC,WAAY,OACZC,eAAgB,CAAEC,MAAO,QAASC,KAAM,WACrCT,OAGDU,EAAc,SACZC,EAAeZ,EAEfa,EAAaC,SAASC,cAAc,UACpCC,EAAcF,SAASC,cAAc,SACrCE,EAAeH,SAASC,cAAc,OACtCG,EAAUJ,SAASC,cAAc,OAyBjCI,EAAU,CAACC,EAAmB,YAC5BC,EAAiB,CACrBC,KAAM,aACNC,QAAS,IACTC,wBAAwB,KACrBJ,GAECK,EAASX,SAASC,cAAc,WAChCX,MAAEA,EAAFC,OAASA,GAAW,IAAIM,EAAYe,kBACvCC,OAAOC,GAASA,EAAMC,SAAS,GAC/BC,iBACHL,EAAOrB,MAAQA,EACfqB,EAAOpB,OAASA,EAChBoB,EAAOM,WAAW,MAAMC,UAAUhB,EAAa,EAAG,GAEd,mBAAzBf,EAAWgC,UAA0B,OACxCX,KAAEA,EAAFC,QAAQA,GAAYF,EAC1BpB,EAAWgC,UAAU,CACnBC,MAAOT,EAAOU,UAAUb,EAAMC,GAC9Ba,SAAU,OAiBVC,EAAmBC,uBACjBC,QAAoBC,UAAUD,YAAYE,MAAM,CAAEC,KAAM,wBACzCH,GAEPI,cAKhB/B,EAAagC,UAAY,cACzB1B,EAAQ0B,aAAe5C,EAAQ4C,WAAa,qBAC5C3B,EAAa2B,aAAe5C,EAAQ4C,WAAa,2BACjD/B,EAAW+B,aAAe5C,EAAQ4C,WAAa,qBAC/C/B,EAAWgC,UAAY1C,EAAQG,kBAC/BO,EAAWiC,UAAW,EACtBjC,EAAWkC,QAAU5B,EACrBH,EAAYgC,UAAW,EACvBhC,EAAYZ,MAAQD,EAAQC,MAC5BY,EAAYX,OAASF,EAAQE,OAC7BW,EAAYiC,MAAMC,UAAY,QAE9BhC,EAAQiC,YAAYlC,GACpBC,EAAQiC,YAAYtC,GACpBD,EAAauC,YAAYjC,GAElB,CACLkC,OAnBa,IAAMlD,EAoBnBiB,QAAAA,EACAkC,KAvFWf,MAAOgB,EAAQC,KACJ,mBAAXD,GACTA,EAAsC,kBAAxBjB,KAGhBnC,GAAY,EACZW,EAAWiC,UAAW,EAEtBN,UAAUgB,aACR,CAAE5B,OAAO,GACT,SAAU6B,GACRxC,EAAa4B,UAAY,GACzB5B,EAAakC,YAAYnC,GACzBA,EAAY0C,UAAYD,EACxB9C,EAAc8C,EACdE,OAAOhD,YAAcA,GAEvB,SAAUiD,GACe,mBAAZL,GAAwBA,EAAQK,MAsE/CC,MAzCYC,IACZjD,EAAWiC,UAAW,EACtB5C,GAAY,EACZc,EAAY0C,UAAY,SAEpB/C,EAAYoD,aAAaC,IAAIC,GAASA,EAAMvD,QAEd,mBAAvBT,EAAWiE,SAA0BJ,GAC9C7D,EAAWiE"}